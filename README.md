๐ค Telegram Bot + Whisper.cpp + OCR (Tesseract)

ะะพะปะฝะพัััั ะปะพะบะฐะปัะฝัะน Telegram-ะฑะพั ั ะฟะพะดะดะตัะถะบะพะน:

    โ ะะฐัะฟะพะทะฝะฐะฒะฐะฝะธั ะณะพะปะพัะพะฒัั ัะพะพะฑัะตะฝะธะน (Whisper.cpp)
    โ OCR ะดะปั ัะพัะพะณัะฐัะธะน ะบะพะดะฐ (Tesseract + OpenCV)
    โ ะะฒัะพะผะฐัะธัะตัะบะพะน ะพัะธััะบะธ ะฒัะตะผะตะฝะฝัั ัะฐะนะปะพะฒ
    โ ะฃะฒะตะดะพะผะปะตะฝะธะน ะฐะดะผะธะฝะธัััะฐัะพัะฐ ะพะฑ ะพัะธะฑะบะฐั
    โ ะัะตัะตะดะธ ะทะฐะดะฐั ั ะทะฐัะธัะพะน ะพั ะฟะตัะตะฟะพะปะฝะตะฝะธั
    โ Health checks ะดะปั ะฒัะตั ัะตัะฒะธัะพะฒ
    โ TypeScript ั ะผะพะดัะปัะฝะพะน ะฐััะธัะตะบัััะพะน
    โ Dev Containers ะดะปั ัะดะพะฑะฝะพะน ัะฐะทัะฐะฑะพัะบะธ

๐ ะขัะตะฑะพะฒะฐะฝะธั

    Docker 20.10+
    Docker Compose 2.0+
    2GB RAM ะผะธะฝะธะผัะผ
    Telegram Bot Token (ะพั @BotFather)
    Telegram User ID (ะพั @userinfobot)

๐ ะัััััะน ััะฐัั
1. ะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน
bash

git clone <your-repo>
cd tg-voice-ocr-bot

2. ะะฐัััะพะนัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
bash

cp bot/.env.example bot/.env
nano bot/.env  # ะธะปะธ ะปัะฑะพะน ะดััะณะพะน ัะตะดะฐะบัะพั

ะะฐะฟะพะปะฝะธัะต .env:
env

BOT_TOKEN=your_bot_token_from_botfather
ADMIN_ID=your_telegram_user_id
WHISPER_URL=http://whisper:8000/stt
OCR_URL=http://ocr:9001/ocr

3. ะกะบะฐัะฐะนัะต ะผะพะดะตะปั Whisper
bash

cd whisper
mkdir -p models
cd models
wget https://huggingface.co/ggerganov/whisper.cpp/resolve/main/ggml-base.bin
cd ../..

4. ะะฐะฟัััะธัะต ะฟัะพะตะบั
bash

# ะัะฟะพะปัะทัั Make (ัะตะบะพะผะตะฝะดัะตััั)
make build
make up

# ะะปะธ ะฝะฐะฟััะผัั ัะตัะตะท Docker Compose
docker compose build
docker compose up -d

5. ะัะพะฒะตัััะต ััะฐััั
bash

make test
# ะธะปะธ
curl http://localhost:8000/health  # Whisper
curl http://localhost:9001/health  # OCR

๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

tg-voice-ocr-bot/
โโโ bot/                           # Telegram Bot (Grammy + TypeScript)
โ   โโโ src/
โ   โ   โโโ index.ts              # ะขะพัะบะฐ ะฒัะพะดะฐ
โ   โ   โโโ config.ts             # ะะพะฝัะธะณััะฐัะธั
โ   โ   โโโ types.ts              # TypeScript ัะธะฟั
โ   โ   โโโ handlers/             # ะะฑัะฐะฑะพััะธะบะธ ัะพะพะฑัะตะฝะธะน
โ   โ   โ   โโโ index.ts
โ   โ   โ   โโโ voice.ts
โ   โ   โ   โโโ photo.ts
โ   โ   โ   โโโ commands.ts
โ   โ   โโโ services/             # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โ       โโโ notifier.ts
โ   โ       โโโ cleanup.ts
โ   โ       โโโ queue.ts
โ   โ       โโโ apiClient.ts
โ   โ       โโโ healthMonitor.ts
โ   โโโ package.json
โ   โโโ tsconfig.json
โ   โโโ Dockerfile
โ   โโโ .env
โ
โโโ whisper/                       # Whisper.cpp HTTP ัะตัะฒะตั
โ   โโโ server.py
โ   โโโ requirements.txt
โ   โโโ Dockerfile
โ   โโโ models/                    # ะะพะดะตะปะธ (*.bin)
โ
โโโ ocr/                           # OCR ัะตัะฒะตั (Tesseract + OpenCV)
โ   โโโ server.py
โ   โโโ Dockerfile
โ
โโโ .devcontainer/                 # โจ Dev Container ะบะพะฝัะธะณััะฐัะธั
โ   โโโ devcontainer.json
โ   โโโ Dockerfile
โ   โโโ README.md
โ
โโโ docker-compose.yml             # Production ะพัะบะตัััะฐัะธั
โโโ docker-compose.dev.yml         # โจ Dev ะพะบััะถะตะฝะธะต
โโโ Makefile
โโโ MIGRATION.md                   # โจ ะะฝััััะบัะธั ะฟะพ ะผะธะณัะฐัะธะธ
โโโ CHANGELOG.md                   # โจ ะััะพัะธั ะธะทะผะตะฝะตะฝะธะน
โโโ README.md

๐ฏ ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั
๐ค ะะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั

ะัะฟัะฐะฒััะต ะณะพะปะพัะพะฒะพะต ัะพะพะฑัะตะฝะธะต โ ะฟะพะปััะธัะต ัะตะบััะพะฒัั ัะฐััะธััะพะฒะบั

ะขะตัะฝะพะปะพะณะธะธ:

    Whisper.cpp (ะปะพะบะฐะปัะฝัะน STT)
    FFmpeg ะดะปั ะบะพะฝะฒะตััะฐัะธะธ OGG โ WAV
    ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ ะฒัะตะผะตะฝะฝัั ัะฐะนะปะพะฒ

๐ผ OCR ะดะปั ัะพัะพะณัะฐัะธะน ะบะพะดะฐ

ะัะฟัะฐะฒััะต ัะพัะพ ั ะบะพะดะพะผ โ ะฟะพะปััะธัะต ัะตะบัั

ะะฑัะฐะฑะพัะบะฐ:

    OpenCV: grayscale โ denoise โ CLAHE โ adaptive threshold
    Tesseract: ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต (eng + rus)
    Pygments: ะพะฟัะตะดะตะปะตะฝะธะต ัะทัะบะฐ ะฟัะพะณัะฐะผะผะธัะพะฒะฐะฝะธั
    ะะพััะพะฑัะฐะฑะพัะบะฐ: ะธัะฟัะฐะฒะปะตะฝะธะต ัะธะฟะธัะฝัั ะพัะธะฑะพะบ OCR

ะคะพัะผะฐัั ะฒัะฒะพะดะฐ:

    ะะพัะพัะบะธะน ัะตะบัั (โค4000 ัะธะผะฒะพะปะพะฒ) โ ัะพัะผะฐัะธัะพะฒะฐะฝะฝัะน ะฑะปะพะบ ะฒ ัะฐัะต
    ะะปะธะฝะฝัะน ัะตะบัั โ ัะฐะนะป ั ัะฐััะธัะตะฝะธะตะผ ะฟะพ ัะธะฟั ะบะพะดะฐ

๐ข ะะพะผะฐะฝะดะฐ "ัะปะตะดัััะธะน"

ะัะฟัะฐะฒััะต ัะตะบัั ัะปะตะดัััะธะน โ ะฟะพะปััะธัะต ะถะธัะฝัะน ะฑะฐะฝะฝะตั
โ๏ธ ะะพะฝัะธะณััะฐัะธั
ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะะตัะตะผะตะฝะฝะฐั	ะะฟะธัะฐะฝะธะต	ะัะธะผะตั
BOT_TOKEN	ะขะพะบะตะฝ Telegram ะฑะพัะฐ	1234567890:ABCdef...
ADMIN_ID	ID ะฐะดะผะธะฝะธัััะฐัะพัะฐ ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน	123456789
WHISPER_URL	URL Whisper API (ะฒะฝัััะตะฝะฝะธะน)	http://whisper:8000/stt
OCR_URL	URL OCR API (ะฒะฝัััะตะฝะฝะธะน)	http://ocr:9001/ocr

ะะตััััั ะบะพะฝัะตะนะฝะตัะพะฒ

ะกะผ. docker-compose.yml:

    Whisper: 2GB limit, 512MB reserved
    OCR: 1GB limit, 256MB reserved
    Bot: 512MB limit, 128MB reserved

๐งน ะะฒัะพะผะฐัะธัะตัะบะฐั ะพัะธััะบะฐ
Bot (Node.js)

    ะะฝัะตัะฒะฐะป: ะบะฐะถะดัะต 15 ะผะธะฝัั
    ะฃะดะฐะปัะตั: ัะฐะนะปั ััะฐััะต 30 ะผะธะฝัั ะธะท ./tmp
    ะะธะฑะปะธะพัะตะบะฐ: node-cron

Whisper & OCR (Python)

    ะะฝัะตัะฒะฐะป: ะบะฐะถะดัะต 10 ะผะธะฝัั
    ะฃะดะฐะปัะตั: ัะฐะนะปั ััะฐััะต 30 ะผะธะฝัั ะธะท /tmp
    ะฃะฒะตะดะพะผะปะตะฝะธั: ะฟัะธ ะพัะธะฑะบะฐั ะพัะธััะบะธ

๐ ะฃะฒะตะดะพะผะปะตะฝะธั ะฐะดะผะธะฝะธัััะฐัะพัั

ะะพั ะพัะฟัะฐะฒะปัะตั ัะพะพะฑัะตะฝะธั ะฐะดะผะธะฝั ะฟัะธ:

    โ๏ธ ะัะธะฑะบะฐั Whisper API
    โ๏ธ ะัะธะฑะบะฐั OCR ัะตัะฒะธัะฐ
    โ๏ธ ะะตัะตะฟะพะปะฝะตะฝะธะธ ะพัะตัะตะดะธ ะทะฐะดะฐั
    โ๏ธ ะัะธะฑะบะฐั ะทะฐะณััะทะบะธ/ัะบะฐัะธะฒะฐะฝะธั ัะฐะนะปะพะฒ
    โ๏ธ ะัะธะฑะบะฐั cron ะพัะธััะบะธ
    โ๏ธ ะะตะดะพัััะฟะฝะพััะธ ัะตัะฒะธัะพะฒ (health check)

๐ Makefile ะบะพะผะฐะฝะดั
bash

make help          # ะะพะบะฐะทะฐัั ะฒัะต ะบะพะผะฐะฝะดั
make build         # ะกะพะฑัะฐัั ะบะพะฝัะตะนะฝะตัั
make up            # ะะฐะฟัััะธัั ัะตัะฒะธัั
make down          # ะััะฐะฝะพะฒะธัั ัะตัะฒะธัั
make restart       # ะะตัะตะทะฐะฟัััะธัั
make logs          # ะะพะบะฐะทะฐัั ะปะพะณะธ ะฒัะตั ัะตัะฒะธัะพะฒ
make logs-bot      # ะะพะณะธ ัะพะปัะบะพ ะฑะพัะฐ
make clean         # ะฃะดะฐะปะธัั ะฒัั (ะบะพะฝัะตะนะฝะตัั, volumes, images)
make test          # ะัะพะฒะตัะธัั health ัะตัะฒะธัะพะฒ
make rebuild       # ะะตัะตัะพะฑัะฐัั ะธ ะฟะตัะตะทะฐะฟัััะธัั
make status        # ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
make dev-up        # ๐ ะะฐะฟัััะธัั dev ะพะบััะถะตะฝะธะต
make dev-down      # ๐ ะััะฐะฝะพะฒะธัั dev ะพะบััะถะตะฝะธะต

๐ง ะะฐะทัะฐะฑะพัะบะฐ
ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ
bash

cd bot
npm install
npm run dev  # Hot reload ัะตะถะธะผ

Dev Container (VS Code)

    ะฃััะฐะฝะพะฒะธัะต ัะฐััะธัะตะฝะธะต "Dev Containers"
    ะัะบัะพะนัะต ะฟัะพะตะบั ะฒ VS Code
    Ctrl+Shift+P โ "Dev Containers: Reopen in Container"
    ะัะต ะณะพัะพะฒะพ! ๐

ะะพะดัะพะฑะฝะตะต: .devcontainer/README.md
npm ัะบัะธะฟัั
bash

npm run build    # ะกะฑะพัะบะฐ TypeScript
npm run start    # ะะฐะฟััะบ ะฟัะพะดะฐะบัะฝ ะฒะตััะธะธ
npm run dev      # ะะตะถะธะผ ัะฐะทัะฐะฑะพัะบะธ ั hot reload
npm run lint     # ESLint ะฟัะพะฒะตัะบะฐ
npm run format   # Prettier ัะพัะผะฐัะธัะพะฒะฐะฝะธะต

๐งช ะขะตััะธัะพะฒะฐะฝะธะต
1. ะะพะปะพัะพะฒะพะต ัะพะพะฑัะตะฝะธะต

ะัะฟัะฐะฒััะต ะณะพะปะพัะพะฒะพะต โ ะฟะพะปััะธัะต ัะตะบัั
2. ะคะพัะพ ั ะบะพะดะพะผ

ะัะฟัะฐะฒััะต ัะบัะธะฝัะพั ะบะพะดะฐ โ ะฟะพะปััะธัะต:

    ะคะพัะผะฐัะธัะพะฒะฐะฝะฝัะน ัะตะบัั (ะตัะปะธ ะบะพัะพัะบะธะน)
    ะคะฐะนะป code_<timestamp>.<ext> (ะตัะปะธ ะดะปะธะฝะฝัะน)

3. ะคะพัะพ ะฑะตะท ัะตะบััะฐ

ะัะฟัะฐะฒััะต ะฟัััะพะต ัะพัะพ โ โ ะขะตะบัั ะฝะต ะฝะฐะนะดะตะฝ ะฝะฐ ะธะทะพะฑัะฐะถะตะฝะธะธ.
4. ะะพะผะฐะฝะดะฐ

ะัะฟัะฐะฒััะต ัะปะตะดัััะธะน โ ะฑะฐะฝะฝะตั
5. ะะตัะตะฟะพะปะฝะตะฝะธะต ะพัะตัะตะดะธ

ะัะฟัะฐะฒััะต 6+ ะณะพะปะพัะพะฒัั ะฟะพะดััะด โ โ๏ธ ะัะตัะตะดั ะฟะตัะตะฟะพะปะฝะตะฝะฐ
๐ ะัะปะฐะดะบะฐ
ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ
bash

# ะัะต ัะตัะฒะธัั
docker compose logs -f

# ะขะพะปัะบะพ ะฑะพั
docker compose logs -f bot

# Whisper
docker compose logs -f whisper

# OCR
docker compose logs -f ocr

ะัะพะฒะตัะบะฐ health
bash

curl http://localhost:8000/health
# {"status":"ok","model":"ggml-base.bin","tmp_files":0}

curl http://localhost:9001/health
# {"status":"ok","tesseract_version":"5.x.x","tmp_files":0}

ะัะพะด ะฒ ะบะพะฝัะตะนะฝะตั
bash

make shell-bot      # ะัะบัััั shell ะฒ ะฑะพัะต
make shell-whisper  # Whisper
make shell-ocr      # OCR

๐ ะััะธัะตะบัััะฐ

โโโโโโโโโโโโโโโ
โ   Telegram  โ
โ    Users    โ
โโโโโโโโฌโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโโ
โ   Bot Service   โโโโโโโถโ   Whisper    โ
โ   (Grammy TS)   โ      โ  (Flask API) โ
โโโโโโโโโโฌโโโโโโโโโ      โโโโโโโโโโโโโโโโ
         โ
         โ               โโโโโโโโโโโโโโโโ
         โโโโโโโโโโโโโโโโถโ     OCR      โ
                        โ  (Flask API) โ
                        โโโโโโโโโโโโโโโโ

ะกะตัั: ะัะต ัะตัะฒะธัั ะฒ ะพะดะฝะพะน Docker bridge ัะตัะธ bot_network

Volumes: ะะฐะทะดะตะปัะฝัะต ะดะปั ะบะฐะถะดะพะณะพ ัะตัะฒะธัะฐ (bot_tmp, whisper_tmp, ocr_tmp)
๐จ ะะทะฒะตััะฝัะต ะฟัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั
Whisper ะฒะพะทะฒัะฐัะฐะตั ะฟัััะพะน ัะตะบัั

ะัะธัะธะฝะฐ: ะะปะพัะพะต ะบะฐัะตััะฒะพ ะฐัะดะธะพ ะธะปะธ ะฝะตะฟะพะดะดะตัะถะธะฒะฐะตะผัะน ัะพัะผะฐั
ะะตัะตะฝะธะต: ะัะพะฒะตัััะต ะปะพะณะธ, ะฟะพะฟัะพะฑัะนัะต ะดััะณัั ะผะพะดะตะปั (ggml-medium.bin)
OCR ะฝะต ัะฐัะฟะพะทะฝะฐะตั ัะตะบัั

ะัะธัะธะฝะฐ: ะะธะทะบะพะต ะบะฐัะตััะฒะพ ัะพัะพ, ัะปะพะถะฝัะน ัะพะฝ
ะะตัะตะฝะธะต: ะฃะปัััะธัะต ะพัะฒะตัะตะฝะธะต, ัะดะตะปะฐะนัะต ัะพัะพ ะฟะพะด ัะณะปะพะผ 90ยฐ
ะะพะฝัะตะนะฝะตั ะฟะฐะดะฐะตั ั OOM

ะัะธัะธะฝะฐ: ะะตะดะพััะฐัะพัะฝะพ ะฟะฐะผััะธ
ะะตัะตะฝะธะต: ะฃะฒะตะปะธัััะต ะปะธะผะธัั ะฒ docker-compose.yml
Bot ะฝะต ะพัะฒะตัะฐะตั

ะัะธัะธะฝะฐ: ะะตะฒะตัะฝัะน ัะพะบะตะฝ ะธะปะธ ะฟัะพะฑะปะตะผั ั ัะตััั
ะะตัะตะฝะธะต: ะัะพะฒะตัััะต .env, ะฟะตัะตะทะฐะฟัััะธัะต: make restart
๐ ะะตะทะพะฟะฐัะฝะพััั

    โ ะะต ะบะพะผะผะธัััะต .env ะฒ git
    โ ะัะฟะพะปัะทัะนัะต strong tokens ะพั BotFather
    โ ะะณัะฐะฝะธัััะต ะดะพัััะฟ ะบ ัะตัะฒะตัั (firewall)
    โ ะะตะณัะปััะฝะพ ะพะฑะฝะพะฒะปัะนัะต ะทะฐะฒะธัะธะผะพััะธ:

bash

cd bot && npm update
pip install --upgrade -r requirements.txt

๐ TODO

    ะะพะดะดะตัะถะบะฐ ะฑะพะปััะตะณะพ ะบะพะปะธัะตััะฒะฐ ัะทัะบะพะฒ OCR
    Web UI ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ
    ะะตััะธะบะธ (Prometheus/Grafana)
    ะะพะดะดะตัะถะบะฐ ะดะพะบัะผะตะฝัะพะฒ (PDF โ ัะตะบัั)
    CI/CD pipeline
    Unit ัะตััั
    Rate limiting ะดะปั ะทะฐัะธัั ะพั ัะฟะฐะผะฐ

๐ ะะธัะตะฝะทะธั

MIT License - ะธัะฟะพะปัะทัะนัะต ัะฒะพะฑะพะดะฝะพ
๐ค Contributing

    Fork ะฟัะพะตะบั
    ะกะพะทะดะฐะนัะต feature branch (git checkout -b feature/AmazingFeature)
    Commit ะธะทะผะตะฝะตะฝะธั (git commit -m 'Add AmazingFeature')
    Push ะฒ branch (git push origin feature/AmazingFeature)
    ะัะบัะพะนัะต Pull Request

๐ ะะพะบัะผะตะฝัะฐัะธั

    MIGRATION.md - ะะธะณัะฐัะธั ะฝะฐ v2.0
    CHANGELOG.md - ะััะพัะธั ะธะทะผะตะฝะตะฝะธะน
    .devcontainer/README.md - Dev Containers

๐ฌ ะะพะดะดะตัะถะบะฐ

ะะฐัะปะธ ะฑะฐะณ? ะััั ะฟัะตะดะปะพะถะตะฝะธะต? ะกะพะทะดะฐะนัะต issue

ะกะดะตะปะฐะฝะพ ั โค๏ธ ะดะปั ะปะพะบะฐะปัะฝะพะณะพ AI

v2.0.0 | Changelog | Migration Guide
