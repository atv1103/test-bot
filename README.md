# Telegram Bot + whisper.cpp + OCR (Tesseract.js)
–ü–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç:

‚úÖ –ü—Ä–∏–Ω–∏–º–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è  
‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑ whisper.cpp (Python —Å–µ—Ä–≤–µ—Ä + APScheduler)  
‚úÖ –ü—Ä–∏–Ω–∏–º–∞—Ç—å —Ñ–æ—Ç–æ —Å –∫–æ–¥–æ–º  
‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Tesseract.js  
‚úÖ –ü—Ä–∏–Ω–∏–º–∞—Ç—å –∫–æ–º–∞–Ω–¥—É ¬´—Å–ª–µ–¥—É—é—â–∏–π¬ª –∏ –≤—ã–≤–æ–¥–∏—Ç—å –∂–∏—Ä–Ω—ã–π –±–∞–Ω–Ω–µ—Ä  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ whisper, OCR –∏ –±–æ—Ç–∞  
‚úÖ –ò–º–µ—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–∏ —É –±–æ—Ç–∞, –∏ —É whisper)  
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cron-–º–µ—Ö–∞–Ω–∏–∑–º—ã:
   - node-cron –≤ Node.js  
   - APScheduler –≤ Python  


---

# üöÄ –ó–∞–ø—É—Å–∫

```bash
docker compose build
docker compose up -d

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:

```bash
curl http://localhost:8000/health   # whisper
curl http://localhost:9001/health   # ocr

üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞
tg-voice-ocr-bot/
‚îú‚îÄ‚îÄ bot/               # Telegram Bot (Grammy)
‚îú‚îÄ‚îÄ whisper/           # Whisper.cpp HTTP wrapper
‚îú‚îÄ‚îÄ ocr/               # Tesseract + OpenCV OCR server
‚îî‚îÄ‚îÄ docker-compose.yml

üñº –§–æ—Ç–æ ‚Üí –ö–æ–¥ (OCR)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è OCR:

OpenCV: grayscale ‚Üí denoise ‚Üí CLAHE ‚Üí adaptive threshold ‚Üí morphology

Tesseract: eng + rus

Auto language detect (pygments)

Code cleanup (—Ñ–∏–∫—Å—ã OCR –æ—à–∏–±–æ–∫)

–ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –∫–æ—Ä–æ—Ç–∫–∏–π ‚Üí HTML <pre>

–ï—Å–ª–∏ –¥–ª–∏–Ω–Ω—ã–π ‚Üí —Ñ–∞–π–ª (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üê —è–∑—ã–∫ –∫–æ–¥–∞)

üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
Whisper & OCR

–ò—Å–ø–æ–ª—å–∑—É—é—Ç APScheduler (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç):

—É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞—Ä—à–µ 30 –º–∏–Ω—É—Ç (/tmp)

Bot

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç node-cron (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç):

–æ—á–∏—Å—Ç–∫–∞ ./tmp –æ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ–¥–∏–∞

–û—à–∏–±–∫–∏ –∫—Ä–æ–Ω-–æ—á–∏—Å—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–¥–º–∏–Ω—É.

‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

–í—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–¥–º–∏–Ω—É:

–æ—à–∏–±–∫–∏ Whisper

–æ—à–∏–±–∫–∏ OCR

–æ—à–∏–±–∫–∏ Telegram API

–æ—à–∏–±–∫–∏ cron –æ—á–∏—Å—Ç–∫–∏

–æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

–ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∏–¥–∞:

‚ö†Ô∏è OCR: can't read image
‚ö†Ô∏è Whisper: timeout
‚ö†Ô∏è Bot error: ENOTFOUND file

üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

Node.js + Grammy

Python + Flask

Whisper.cpp

Tesseract OCR

OpenCV

APScheduler

node-cron

Docker Compose


üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–ø—Ä–∞–≤—å:

–≥–æ–ª–æ—Å ‚Üí –ø–æ–ª—É—á–∏—à—å —Ç–µ–∫—Å—Ç

—Ñ–æ—Ç–æ –∫–æ–¥–∞ ‚Üí –ø–æ–ª—É—á–∏—à—å –∫–æ–¥

—Ç–µ–∫—Å—Ç ¬´—Å–ª–µ–¥—É—é—â–∏–π¬ª ‚Üí –±–∞–Ω–Ω–µ—Ä

—Ñ–æ—Ç–æ –±–µ–∑ —Ç–µ–∫—Å—Ç–∞ ‚Üí –±–æ—Ç —Å–∫–∞–∂–µ—Ç ¬´–¢–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω¬ª
